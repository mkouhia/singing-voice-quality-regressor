schema: '2.0'
stages:
  clean:
    cmd: python -m singing_classifier.clean --data SVQTD/test.csv SVQTD/train.csv
      SVQTD/dev.csv --data-out data/test_clean.parquet data/train_clean.parquet data/dev_clean.parquet
      -- SVQTD/seg_time_lists.csv data/segments_clean.parquet
    deps:
    - path: SVQTD/dev.csv
      md5: ce209aba6b1bb67709e3ca32d5be3ace
      size: 55116
    - path: SVQTD/seg_time_lists.csv
      md5: e37b920502300aa43fa26e242c35d350
      size: 283800
    - path: SVQTD/test.csv
      md5: 39969a96a0df21f2a59eb5c0feea043f
      size: 55115
    - path: SVQTD/train.csv
      md5: 908c148326940c6284f976a53991834b
      size: 173476
    - path: singing_classifier/clean.py
      md5: f873d262647eb953e75a7da8efdf5dbc
      size: 7741
    outs:
    - path: data/dev_clean.parquet
      md5: 09d3c97c567edc4c2e8c885fe2a85fab
      size: 17034
    - path: data/segments_clean.parquet
      md5: 5991857ad4f3c61c0e6470749292c679
      size: 87083
    - path: data/test_clean.parquet
      md5: 9fb38c5d41f618a24934a8f49ccd3709
      size: 16921
    - path: data/train_clean.parquet
      md5: 157fdf8009127a267ae74e27015c6b15
      size: 28994
  etl:
    cmd: python -m singing_classifier.etl --download-summary data/etl_audio_summary.parquet
      --split-summary data/etl_segment_summary.parquet data/segments_clean.parquet
      data/audio_raw data/audio_segments
    deps:
    - path: data/segments_clean.parquet
      md5: 5991857ad4f3c61c0e6470749292c679
      size: 87083
    - path: singing_classifier/etl.py
      md5: 75936c2aa8fb789edc02f9c53d8528b9
      size: 18531
    outs:
    - path: data/audio_segments
      md5: bf5d7e47f617e627492a75511d06fb82.dir
      size: 821987034
      nfiles: 3594
    - path: data/etl_audio_summary.parquet
      md5: dcaf5e3f85c41a3e3e96efb77bbf41e2
      size: 10958
    - path: data/etl_segment_summary.parquet
      md5: 4e30dc664ab1f7b7744f2c5bceecfdf8
      size: 47919
  filter@dev:
    cmd: python -m singing_classifier.filter --num-col seg_num data/etl_segment_summary.parquet
      data/dev_clean.parquet data/dev_filter.parquet
    deps:
    - path: data/dev_clean.parquet
      md5: 09d3c97c567edc4c2e8c885fe2a85fab
      size: 17034
    - path: data/etl_segment_summary.parquet
      md5: 4e30dc664ab1f7b7744f2c5bceecfdf8
      size: 47919
    - path: singing_classifier/filter.py
      md5: 5528e63da544cbe3fb20dcc77858a439
      size: 1529
    outs:
    - path: data/dev_filter.parquet
      md5: cea615e745e408f2121e95e7f9cf4eb2
      size: 16250
  filter@test:
    cmd: python -m singing_classifier.filter --num-col seg_num data/etl_segment_summary.parquet
      data/test_clean.parquet data/test_filter.parquet
    deps:
    - path: data/etl_segment_summary.parquet
      md5: 4e30dc664ab1f7b7744f2c5bceecfdf8
      size: 47919
    - path: data/test_clean.parquet
      md5: 9fb38c5d41f618a24934a8f49ccd3709
      size: 16921
    - path: singing_classifier/filter.py
      md5: 5528e63da544cbe3fb20dcc77858a439
      size: 1529
    outs:
    - path: data/test_filter.parquet
      md5: 917d1a061a411eb360e63e0cf482c770
      size: 16286
  filter@train:
    cmd: python -m singing_classifier.filter --num-col seg_num data/etl_segment_summary.parquet
      data/train_clean.parquet data/train_filter.parquet
    deps:
    - path: data/etl_segment_summary.parquet
      md5: 4e30dc664ab1f7b7744f2c5bceecfdf8
      size: 47919
    - path: data/train_clean.parquet
      md5: 157fdf8009127a267ae74e27015c6b15
      size: 28994
    - path: singing_classifier/filter.py
      md5: 5528e63da544cbe3fb20dcc77858a439
      size: 1529
    outs:
    - path: data/train_filter.parquet
      md5: 46af142486a285c66b993ddf7aca8e78
      size: 26444
  filter@segments:
    cmd: python -m singing_classifier.filter --num-col num data/etl_segment_summary.parquet
      data/segments_clean.parquet data/segments_filter.parquet
    deps:
    - path: data/etl_segment_summary.parquet
      md5: 4e30dc664ab1f7b7744f2c5bceecfdf8
      size: 47919
    - path: data/segments_clean.parquet
      md5: 5991857ad4f3c61c0e6470749292c679
      size: 87083
    - path: singing_classifier/filter.py
      md5: 5528e63da544cbe3fb20dcc77858a439
      size: 1529
    outs:
    - path: data/segments_filter.parquet
      md5: 8205b0c92512a50853319fe97362f6f3
      size: 78749
  train:
    cmd: python -m singing_classifier.train --epochs 10 --sample-rate 16000 --batch-duration-ms
      4000 --batch-size 64 --n-fft 400 --train data/train_filter.parquet --valid data/dev_filter.parquet
      --segment_summary data/etl_segment_summary.parquet --metrics metrics/valid.json
      --lr-plot plots/lr.png --loss-plot plots/loss.png --targets Head Chest Open
      Breathy Vibrato Front Back -- models/model.pkl
    deps:
    - path: data/dev_filter.parquet
      md5: cea615e745e408f2121e95e7f9cf4eb2
      size: 16250
    - path: data/etl_segment_summary.parquet
      md5: 4e30dc664ab1f7b7744f2c5bceecfdf8
      size: 47919
    - path: data/train_filter.parquet
      md5: 46af142486a285c66b993ddf7aca8e78
      size: 26444
    - path: singing_classifier/train.py
      md5: 8adae7d72dcb75ba924bb0823134c93a
      size: 7090
    params:
      params.yaml:
        model.targets:
          targets:
          - Head
          - Chest
          - Open
          - Breathy
          - Vibrato
          - Front
          - Back
        nn.batch.audio-length-ms: 4000
        nn.batch.size: 64
        nn.epochs: 10
        nn.mel-spectrogram.n-fft: 400
        nn.mel-spectrogram.sample-rate: 16000
    outs:
    - path: metrics/valid.json
      md5: 8a80554c91d9fca8acb82f023de02f11
      size: 3
    - path: models/model.pkl
      md5: 57b5bde11a5b39c71bd89a7a22df8aca
      size: 47096109
    - path: plots/loss.png
      md5: 05aaf5f29bd59c2a14f6f31865de33a5
      size: 22698
    - path: plots/lr.png
      md5: 747ac2987025359dc648169f89b78ed9
      size: 20098
  train@Head:
    cmd: python -m singing_classifier.train --epochs 10 --sample-rate 16000 --batch-duration-ms
      4000 --batch-size 64 --n-fft 400 --train data/train_filter.parquet --valid data/dev_filter.parquet
      --segment_summary data/etl_segment_summary.parquet --metrics metrics/valid/Head.json
      --lr-plot plots/lr_Head.png --loss-plot plots/loss_Head.png Head models/Head.pkl
    deps:
    - path: data/dev_filter.parquet
      md5: cea615e745e408f2121e95e7f9cf4eb2
      size: 16250
    - path: data/etl_segment_summary.parquet
      md5: 4e30dc664ab1f7b7744f2c5bceecfdf8
      size: 47919
    - path: data/train_filter.parquet
      md5: 46af142486a285c66b993ddf7aca8e78
      size: 26444
    - path: singing_classifier/train.py
      md5: bca7ea2c5efe0383159d887eee55f553
      size: 6167
    params:
      params.yaml:
        nn.batch.audio-length-ms: 4000
        nn.batch.size: 64
        nn.epochs: 10
        nn.mel-spectrogram.n-fft: 400
        nn.mel-spectrogram.sample-rate: 16000
    outs:
    - path: metrics/valid/Head.json
      md5: 342dff98bfbb55e97fc1af7b5ab2d8bb
      size: 76
    - path: models/Head.pkl
      md5: 0351abf6efb587ca3fe304b7e154cd4a
      size: 47122167
    - path: plots/loss_Head.png
      md5: d51e2246b82aa9a0c75e3b9013562ac5
      size: 24639
    - path: plots/lr_Head.png
      md5: eb8b47a920dff652a9f2e29783d21275
      size: 23809
  train@Open:
    cmd: python -m singing_classifier.train --epochs 10 --sample-rate 16000 --batch-duration-ms
      4000 --batch-size 64 --n-fft 400 --train data/train_filter.parquet --valid data/dev_filter.parquet
      --segment_summary data/etl_segment_summary.parquet --metrics metrics/valid/Open.json
      --lr-plot plots/lr_Open.png --loss-plot plots/loss_Open.png Open models/Open.pkl
    deps:
    - path: data/dev_filter.parquet
      md5: cea615e745e408f2121e95e7f9cf4eb2
      size: 16250
    - path: data/etl_segment_summary.parquet
      md5: 4e30dc664ab1f7b7744f2c5bceecfdf8
      size: 47919
    - path: data/train_filter.parquet
      md5: 46af142486a285c66b993ddf7aca8e78
      size: 26444
    - path: singing_classifier/train.py
      md5: bca7ea2c5efe0383159d887eee55f553
      size: 6167
    params:
      params.yaml:
        nn.batch.audio-length-ms: 4000
        nn.batch.size: 64
        nn.epochs: 10
        nn.mel-spectrogram.n-fft: 400
        nn.mel-spectrogram.sample-rate: 16000
    outs:
    - path: metrics/valid/Open.json
      md5: ba81e3194186472ce439c99487df88a1
      size: 76
    - path: models/Open.pkl
      md5: e87dc9ab7de4bc1e41743ed8248b035d
      size: 47122167
    - path: plots/loss_Open.png
      md5: d211ab3e9eefae39aa0d2039c5dc427a
      size: 23808
    - path: plots/lr_Open.png
      md5: ea32c7a86cdc7b2e9bf3ad9c7e3f93e1
      size: 22571
  train@Breathy:
    cmd: python -m singing_classifier.train --epochs 10 --sample-rate 16000 --batch-duration-ms
      4000 --batch-size 64 --n-fft 400 --train data/train_filter.parquet --valid data/dev_filter.parquet
      --segment_summary data/etl_segment_summary.parquet --metrics metrics/valid/Breathy.json
      --lr-plot plots/lr_Breathy.png --loss-plot plots/loss_Breathy.png Breathy models/Breathy.pkl
    deps:
    - path: data/dev_filter.parquet
      md5: cea615e745e408f2121e95e7f9cf4eb2
      size: 16250
    - path: data/etl_segment_summary.parquet
      md5: 4e30dc664ab1f7b7744f2c5bceecfdf8
      size: 47919
    - path: data/train_filter.parquet
      md5: 46af142486a285c66b993ddf7aca8e78
      size: 26444
    - path: singing_classifier/train.py
      md5: bca7ea2c5efe0383159d887eee55f553
      size: 6167
    params:
      params.yaml:
        nn.batch.audio-length-ms: 4000
        nn.batch.size: 64
        nn.epochs: 10
        nn.mel-spectrogram.n-fft: 400
        nn.mel-spectrogram.sample-rate: 16000
    outs:
    - path: metrics/valid/Breathy.json
      md5: 2812fb12f363788b8a9f26d152ced348
      size: 76
    - path: models/Breathy.pkl
      md5: 13d83db746729b16a57da28f36f36c1b
      size: 47108727
    - path: plots/loss_Breathy.png
      md5: b4443def98ae390bea12cb453a0de86e
      size: 25338
    - path: plots/lr_Breathy.png
      md5: 80291ed31eee204d63f038ee10053754
      size: 21227
  train@Front:
    cmd: python -m singing_classifier.train --epochs 10 --sample-rate 16000 --batch-duration-ms
      4000 --batch-size 64 --n-fft 400 --train data/train_filter.parquet --valid data/dev_filter.parquet
      --segment_summary data/etl_segment_summary.parquet --metrics metrics/valid/Front.json
      --lr-plot plots/lr_Front.png --loss-plot plots/loss_Front.png Front models/Front.pkl
    deps:
    - path: data/dev_filter.parquet
      md5: cea615e745e408f2121e95e7f9cf4eb2
      size: 16250
    - path: data/etl_segment_summary.parquet
      md5: 4e30dc664ab1f7b7744f2c5bceecfdf8
      size: 47919
    - path: data/train_filter.parquet
      md5: 46af142486a285c66b993ddf7aca8e78
      size: 26444
    - path: singing_classifier/train.py
      md5: bca7ea2c5efe0383159d887eee55f553
      size: 6167
    params:
      params.yaml:
        nn.batch.audio-length-ms: 4000
        nn.batch.size: 64
        nn.epochs: 10
        nn.mel-spectrogram.n-fft: 400
        nn.mel-spectrogram.sample-rate: 16000
    outs:
    - path: metrics/valid/Front.json
      md5: 040114da4801f38bd2779563cb44e2bc
      size: 76
    - path: models/Front.pkl
      md5: d746ba316131599aa941ecf7badad1f6
      size: 47116855
    - path: plots/loss_Front.png
      md5: 4521b5497c412a900d3d82f41e51d476
      size: 25943
    - path: plots/lr_Front.png
      md5: 1132ac779e40ec4fae785258cab6134a
      size: 22472
  train@Vibrato:
    cmd: python -m singing_classifier.train --epochs 10 --sample-rate 16000 --batch-duration-ms
      4000 --batch-size 64 --n-fft 400 --train data/train_filter.parquet --valid data/dev_filter.parquet
      --segment_summary data/etl_segment_summary.parquet --metrics metrics/valid/Vibrato.json
      --lr-plot plots/lr_Vibrato.png --loss-plot plots/loss_Vibrato.png Vibrato models/Vibrato.pkl
    deps:
    - path: data/dev_filter.parquet
      md5: cea615e745e408f2121e95e7f9cf4eb2
      size: 16250
    - path: data/etl_segment_summary.parquet
      md5: 4e30dc664ab1f7b7744f2c5bceecfdf8
      size: 47919
    - path: data/train_filter.parquet
      md5: 46af142486a285c66b993ddf7aca8e78
      size: 26444
    - path: singing_classifier/train.py
      md5: bca7ea2c5efe0383159d887eee55f553
      size: 6167
    params:
      params.yaml:
        nn.batch.audio-length-ms: 4000
        nn.batch.size: 64
        nn.epochs: 10
        nn.mel-spectrogram.n-fft: 400
        nn.mel-spectrogram.sample-rate: 16000
    outs:
    - path: metrics/valid/Vibrato.json
      md5: 854521dff2653a6d1dc99f97b2e6f368
      size: 76
    - path: models/Vibrato.pkl
      md5: 220257bbd4bd98e0bab02f3221e7c4de
      size: 47116919
    - path: plots/loss_Vibrato.png
      md5: 144b793b97183ee1b554a8938e2ae438
      size: 24871
    - path: plots/lr_Vibrato.png
      md5: e4a2c80631f34f334a1e3bbc17a4904c
      size: 22710
  train@Chest:
    cmd: python -m singing_classifier.train --epochs 10 --sample-rate 16000 --batch-duration-ms
      4000 --batch-size 64 --n-fft 400 --train data/train_filter.parquet --valid data/dev_filter.parquet
      --segment_summary data/etl_segment_summary.parquet --metrics metrics/valid/Chest.json
      --lr-plot plots/lr_Chest.png --loss-plot plots/loss_Chest.png Chest models/Chest.pkl
    deps:
    - path: data/dev_filter.parquet
      md5: cea615e745e408f2121e95e7f9cf4eb2
      size: 16250
    - path: data/etl_segment_summary.parquet
      md5: 4e30dc664ab1f7b7744f2c5bceecfdf8
      size: 47919
    - path: data/train_filter.parquet
      md5: 46af142486a285c66b993ddf7aca8e78
      size: 26444
    - path: singing_classifier/train.py
      md5: bca7ea2c5efe0383159d887eee55f553
      size: 6167
    params:
      params.yaml:
        nn.batch.audio-length-ms: 4000
        nn.batch.size: 64
        nn.epochs: 10
        nn.mel-spectrogram.n-fft: 400
        nn.mel-spectrogram.sample-rate: 16000
    outs:
    - path: metrics/valid/Chest.json
      md5: e75c29ba7b24d1b6bb67784b7455b3a9
      size: 76
    - path: models/Chest.pkl
      md5: 7b4516ce86557f9da1397033290e1014
      size: 47122167
    - path: plots/loss_Chest.png
      md5: 9b7543f094b144ee9958c6f1c11417a6
      size: 23973
    - path: plots/lr_Chest.png
      md5: b3aaa28fb5ce46174ce52baaf993f61d
      size: 23425
  train@Back:
    cmd: python -m singing_classifier.train --epochs 10 --sample-rate 16000 --batch-duration-ms
      4000 --batch-size 64 --n-fft 400 --train data/train_filter.parquet --valid data/dev_filter.parquet
      --segment_summary data/etl_segment_summary.parquet --metrics metrics/valid/Back.json
      --lr-plot plots/lr_Back.png --loss-plot plots/loss_Back.png Back models/Back.pkl
    deps:
    - path: data/dev_filter.parquet
      md5: cea615e745e408f2121e95e7f9cf4eb2
      size: 16250
    - path: data/etl_segment_summary.parquet
      md5: 4e30dc664ab1f7b7744f2c5bceecfdf8
      size: 47919
    - path: data/train_filter.parquet
      md5: 46af142486a285c66b993ddf7aca8e78
      size: 26444
    - path: singing_classifier/train.py
      md5: bca7ea2c5efe0383159d887eee55f553
      size: 6167
    params:
      params.yaml:
        nn.batch.audio-length-ms: 4000
        nn.batch.size: 64
        nn.epochs: 10
        nn.mel-spectrogram.n-fft: 400
        nn.mel-spectrogram.sample-rate: 16000
    outs:
    - path: metrics/valid/Back.json
      md5: a666645922fe5d398096211d71d49248
      size: 76
    - path: models/Back.pkl
      md5: 4bb796ffd87fbd5176698f248b5a5555
      size: 47116855
    - path: plots/loss_Back.png
      md5: a50bf1c2a6478d81cb600f7de524ff17
      size: 25018
    - path: plots/lr_Back.png
      md5: 78def754dcacd17597967e1aebe3c53b
      size: 22415
  merge@test:
    cmd: python -m singing_classifier.merge --filter --num-col seg_num data/etl_segment_summary.parquet
      data/test_clean.parquet data/test_filter.parquet
    deps:
    - path: data/etl_segment_summary.parquet
      md5: 4e30dc664ab1f7b7744f2c5bceecfdf8
      size: 47919
    - path: data/test_clean.parquet
      md5: 9fb38c5d41f618a24934a8f49ccd3709
      size: 16921
    - path: singing_classifier/merge.py
      md5: cbf0fc5dffe34f52ba11389b9d8c052c
      size: 2471
    outs:
    - path: data/test_filter.parquet
      md5: 46d72e3da0365b08cfbc705d9f671839
      size: 24962
  merge@dev:
    cmd: python -m singing_classifier.merge --filter --num-col seg_num data/etl_segment_summary.parquet
      data/dev_clean.parquet data/dev_filter.parquet
    deps:
    - path: data/dev_clean.parquet
      md5: 09d3c97c567edc4c2e8c885fe2a85fab
      size: 17034
    - path: data/etl_segment_summary.parquet
      md5: 4e30dc664ab1f7b7744f2c5bceecfdf8
      size: 47919
    - path: singing_classifier/merge.py
      md5: cbf0fc5dffe34f52ba11389b9d8c052c
      size: 2471
    outs:
    - path: data/dev_filter.parquet
      md5: 13b7bd251bbca8e0cdf48c237b3d2dce
      size: 24846
  merge@segments:
    cmd: python -m singing_classifier.merge --filter --num-col num data/etl_segment_summary.parquet
      data/segments_clean.parquet data/segments_filter.parquet
    deps:
    - path: data/etl_segment_summary.parquet
      md5: 4e30dc664ab1f7b7744f2c5bceecfdf8
      size: 47919
    - path: data/segments_clean.parquet
      md5: 5991857ad4f3c61c0e6470749292c679
      size: 87083
    - path: singing_classifier/merge.py
      md5: cbf0fc5dffe34f52ba11389b9d8c052c
      size: 2471
    outs:
    - path: data/segments_filter.parquet
      md5: dc0e20da851578c0fc3c16a69084911a
      size: 107379
  merge@train:
    cmd: python -m singing_classifier.merge --filter --num-col seg_num data/etl_segment_summary.parquet
      data/train_clean.parquet data/train_filter.parquet
    deps:
    - path: data/etl_segment_summary.parquet
      md5: 4e30dc664ab1f7b7744f2c5bceecfdf8
      size: 47919
    - path: data/train_clean.parquet
      md5: 157fdf8009127a267ae74e27015c6b15
      size: 28994
    - path: singing_classifier/merge.py
      md5: cbf0fc5dffe34f52ba11389b9d8c052c
      size: 2471
    outs:
    - path: data/train_filter.parquet
      md5: ab52c71563913f6ea16d0af261992555
      size: 45446
