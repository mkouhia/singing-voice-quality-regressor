schema: '2.0'
stages:
  clean:
    cmd: python -m singing_classifier.clean --data SVQTD/test.csv SVQTD/train.csv
      SVQTD/dev.csv --data-out data/test_clean.parquet data/train_clean.parquet data/dev_clean.parquet
      -- SVQTD/seg_time_lists.csv data/segments_clean.parquet
    deps:
    - path: SVQTD/dev.csv
      md5: ce209aba6b1bb67709e3ca32d5be3ace
      size: 55116
    - path: SVQTD/seg_time_lists.csv
      md5: e37b920502300aa43fa26e242c35d350
      size: 283800
    - path: SVQTD/test.csv
      md5: 39969a96a0df21f2a59eb5c0feea043f
      size: 55115
    - path: SVQTD/train.csv
      md5: 908c148326940c6284f976a53991834b
      size: 173476
    - path: singing_classifier/clean.py
      md5: f873d262647eb953e75a7da8efdf5dbc
      size: 7741
    outs:
    - path: data/dev_clean.parquet
      md5: 09d3c97c567edc4c2e8c885fe2a85fab
      size: 17034
    - path: data/segments_clean.parquet
      md5: 5991857ad4f3c61c0e6470749292c679
      size: 87083
    - path: data/test_clean.parquet
      md5: 9fb38c5d41f618a24934a8f49ccd3709
      size: 16921
    - path: data/train_clean.parquet
      md5: 157fdf8009127a267ae74e27015c6b15
      size: 28994
  etl:
    cmd: python -m singing_classifier.etl --download-summary data/etl_audio_summary.parquet
      --split-summary data/etl_segment_summary.parquet data/segments_clean.parquet
      data/audio_raw data/audio_segments
    deps:
    - path: data/segments_clean.parquet
      md5: 5991857ad4f3c61c0e6470749292c679
      size: 87083
    - path: singing_classifier/etl.py
      md5: 75936c2aa8fb789edc02f9c53d8528b9
      size: 18531
    outs:
    - path: data/audio_raw
      md5: 601d9f2c9f23efc7b5d127f166ee5521.dir
      size: 1027731597
      nfiles: 242
    - path: data/audio_segments
      md5: bf5d7e47f617e627492a75511d06fb82.dir
      size: 821987034
      nfiles: 3594
    - path: data/etl_audio_summary.parquet
      md5: dcaf5e3f85c41a3e3e96efb77bbf41e2
      size: 10958
    - path: data/etl_segment_summary.parquet
      md5: 4e30dc664ab1f7b7744f2c5bceecfdf8
      size: 47919
  filter@dev:
    cmd: python -m singing_classifier.filter --num-col seg_num data/etl_segment_summary.parquet
      data/dev_clean.parquet data/dev_filter.parquet
    deps:
    - path: data/dev_clean.parquet
      md5: 09d3c97c567edc4c2e8c885fe2a85fab
      size: 17034
    - path: data/etl_segment_summary.parquet
      md5: 4e30dc664ab1f7b7744f2c5bceecfdf8
      size: 47919
    - path: singing_classifier/filter.py
      md5: 5528e63da544cbe3fb20dcc77858a439
      size: 1529
    outs:
    - path: data/dev_filter.parquet
      md5: cea615e745e408f2121e95e7f9cf4eb2
      size: 16250
  filter@test:
    cmd: python -m singing_classifier.filter --num-col seg_num data/etl_segment_summary.parquet
      data/test_clean.parquet data/test_filter.parquet
    deps:
    - path: data/etl_segment_summary.parquet
      md5: 4e30dc664ab1f7b7744f2c5bceecfdf8
      size: 47919
    - path: data/test_clean.parquet
      md5: 9fb38c5d41f618a24934a8f49ccd3709
      size: 16921
    - path: singing_classifier/filter.py
      md5: 5528e63da544cbe3fb20dcc77858a439
      size: 1529
    outs:
    - path: data/test_filter.parquet
      md5: 917d1a061a411eb360e63e0cf482c770
      size: 16286
  filter@train:
    cmd: python -m singing_classifier.filter --num-col seg_num data/etl_segment_summary.parquet
      data/train_clean.parquet data/train_filter.parquet
    deps:
    - path: data/etl_segment_summary.parquet
      md5: 4e30dc664ab1f7b7744f2c5bceecfdf8
      size: 47919
    - path: data/train_clean.parquet
      md5: 157fdf8009127a267ae74e27015c6b15
      size: 28994
    - path: singing_classifier/filter.py
      md5: 5528e63da544cbe3fb20dcc77858a439
      size: 1529
    outs:
    - path: data/train_filter.parquet
      md5: 46af142486a285c66b993ddf7aca8e78
      size: 26444
  filter@segments:
    cmd: python -m singing_classifier.filter --num-col num data/etl_segment_summary.parquet
      data/segments_clean.parquet data/segments_filter.parquet
    deps:
    - path: data/etl_segment_summary.parquet
      md5: 4e30dc664ab1f7b7744f2c5bceecfdf8
      size: 47919
    - path: data/segments_clean.parquet
      md5: 5991857ad4f3c61c0e6470749292c679
      size: 87083
    - path: singing_classifier/filter.py
      md5: 5528e63da544cbe3fb20dcc77858a439
      size: 1529
    outs:
    - path: data/segments_filter.parquet
      md5: 8205b0c92512a50853319fe97362f6f3
      size: 78749
  train:
    cmd: python -m singing_classifier.train --epochs 2 --sample-rate 16000 --batch-duration-ms
      4000 --batch-size 64 --train data/train_filter.parquet --valid data/dev_filter.parquet
      --segment_summary data/etl_segment_summary.parquet Head models/Head.pkl
    deps:
    - path: data/dev_filter.parquet
      md5: cea615e745e408f2121e95e7f9cf4eb2
      size: 16250
    - path: data/etl_segment_summary.parquet
      md5: 4e30dc664ab1f7b7744f2c5bceecfdf8
      size: 47919
    - path: data/train_filter.parquet
      md5: 46af142486a285c66b993ddf7aca8e78
      size: 26444
    - path: singing_classifier/train.py
      md5: 9a6d63ac563acd589a8f9c64d6ca67c5
      size: 4371
    params:
      params.yaml:
        models.test-target: Head
        nn.batch.audio-length-ms: 4000
        nn.batch.size: 64
        nn.epochs: 2
        nn.sample-rate: 16000
    outs:
    - path: models/Head.pkl
      md5: 4fbf21b602456ec4ab75a038ebcbebd9
      size: 47122306
